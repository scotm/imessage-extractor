<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Export - {{ chat.display_name or chat.participants | join(', ') }}</title>
    <link rel="stylesheet" href="styles/chat.css">
</head>
<body>
    <header>
        <h1>Chat: {{ chat.display_name or chat.participants | join(', ') }}</h1>
        <div class="chat-info">
            <span>Exported: {{ export_date }}</span>
            <span>{{ total_messages }} messages</span>
        </div>
    </header>
    
    <main class="chat-container" role="main">
        {% for date, messages in messages_by_date.items() %}
        <div class="date-group" role="region" aria-label="Messages from {{ date }}">
            <div class="date-header" role="heading" aria-level="2">{{ date }}</div>
            {% for msg in messages %}
            <div class="message {% if msg.from_me %}sent{% else %}received{% endif %}" role="article" aria-label="{% if msg.from_me %}Sent message{% else %}Received message{% endif %}">
                <div class="message-bubble">
                    {% if msg.text %}
                    <div class="message-text">{{ msg.text }}</div>
                    {% endif %}
                    {% if msg.attachments %}
                    <div class="message-attachments">
                        {% for att in msg.attachments %}
                            {% if 'image' in att.mime %}
                            <img src="{{ att.copied_path }}" alt="{{ att.name or 'Image attachment' }}" class="attachment-image">
                            {% elif 'video' in att.mime %}
                            <video controls class="attachment-video" aria-label="Video attachment">
                                <source src="{{ att.copied_path }}" type="{{ att.mime }}">
                                Your browser does not support the video tag.
                            </video>
                            {% else %}
                            <a href="{{ att.copied_path }}" download aria-label="Download attachment {{ att.name or 'file' }}">{{ att.name or "Attachment" }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="message-info">
                        <span class="sender">{{ msg.sender }}</span>
                        <span class="timestamp">{{ parse_timestamp(msg.timestamp) if msg.timestamp else '' }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </main>
</body>
</html>
